name: "GHES → GHEC Migration Request"
description: "Request migration of a repository from GitHub Enterprise Server (GHES) to GitHub Enterprise Cloud (GHEC) using GEI CLI"
title: "[GHEC Migration] "
labels: ["ghec-migration-request"]
body:
  - type: markdown
    attributes:
      value: |
        ## GHES → GHEC Repository Migration
        Use this form to request migration of a repository from a **GitHub Enterprise Server (GHES)** instance to **GitHub Enterprise Cloud (GHEC)**.

        The workflow handles validation, GEI migration, branch protection migration, GHAS settings, environment migration, and post-migration verification.

        > **Prerequisites:**
        > - Source GHES instance must be reachable from GitHub Actions runners
        > - Source repo must not be archived
        > - Target organization must exist on GitHub.com (GHEC)
        > - Target repository name must not already be taken
        > - `GH_SOURCE_PAT` secret must have read access to the source GHES repository
        > - `GH_TARGET_PAT` secret must have write access to the target GHEC organization

  - type: markdown
    attributes:
      value: |
        ### Source (GHES)

  - type: input
    id: ghes_url
    attributes:
      label: "Source GHES URL"
      description: "The base URL of your GitHub Enterprise Server instance (the API URL will be derived automatically)"
      placeholder: "https://github.example.com"
    validations:
      required: true

  - type: input
    id: source_organization
    attributes:
      label: "Source Organization"
      description: "The organization or user on GHES that owns the repository"
      placeholder: "my-org"
    validations:
      required: true

  - type: input
    id: source_repo
    attributes:
      label: "Source Repository Name"
      description: "The exact repository name on GHES to migrate"
      placeholder: "my-repo"
    validations:
      required: true

  - type: markdown
    attributes:
      value: |
        ### Target (GHEC)

  - type: input
    id: target_organization
    attributes:
      label: "Target Organization"
      description: "The target GitHub.com (GHEC) organization where the repository will be migrated to"
      placeholder: "my-ghec-org"
    validations:
      required: true

  - type: input
    id: target_repo
    attributes:
      label: "Target Repository Name"
      description: "Name for the repository on GHEC. Must follow naming convention: lowercase alphanumeric segments separated by hyphens (e.g., mbbmy-dbdo-app-mae-mobile)"
      placeholder: "my-migrated-repo"
    validations:
      required: true

  - type: dropdown
    id: target_visibility
    attributes:
      label: "Target Visibility"
      description: "Visibility of the repository on GHEC"
      options:
        - private
        - internal
        - public
      default: 0
    validations:
      required: true

  - type: markdown
    attributes:
      value: |
        ### Migration Options

  - type: checkboxes
    id: migration_options
    attributes:
      label: "Migration Options"
      description: "Select additional migration options"
      options:
        - label: "Archive source repository after successful migration"
          required: false

  - type: markdown
    attributes:
      value: |
        ### Access & Permissions

  - type: input
    id: admins
    attributes:
      label: "Admins"
      description: "Comma-separated list of GitHub usernames who will be assigned admin access to the target repository after migration"
      placeholder: "@user1, @user2, @user3"
    validations:
      required: true

  - type: textarea
    id: team_mappings
    attributes:
      label: "Team Access Mappings"
      description: |
        Map source teams to target teams for repository access on GHEC. One mapping per line.
        Format: `<source-team-slug> → <target-team-slug> : <permission>`
        Permissions: pull, push, admin, maintain, triage
      placeholder: |
        dev-team → dev-team : push
        platform-team → platform-team : admin
        qa-team → qa-team : triage

  - type: textarea
    id: justification
    attributes:
      label: "Justification"
      description: "Reason for initiating this GHES → GHEC migration"
      placeholder: "e.g., Migrating from on-premises GHES to cloud as part of infrastructure modernization"
    validations:
      required: true

  - type: checkboxes
    id: confirmation
    attributes:
      label: "Confirmation"
      description: "Please confirm the following before submitting"
      options:
        - label: "I have verified the source GHES URL, organization, and repository name are correct"
          required: true
        - label: "I have confirmed the GHES instance is reachable from GitHub Actions runners"
          required: true
        - label: "I have notified the repository owners about this migration"
          required: true
        - label: "I understand there will be a brief freeze period during migration"
          required: true
